<html xmlns:th="http://www.thymeleaf.org" layout:decorate="/my/index.html">
    <head>
        <script th:src="@{/my/js/order.js}"></script>
        <script>
            function tableReload(pg) {
                let beginDate = $('input[name=begin]').val();
                let endDate = $('input[name=end]').val();
                const jsonData = {
                    "begin" : beginDate,
                    "end" : endDate,
                    "pg" : pg
                }
                var contextPath = "[[${@environment.getProperty('server.servlet.context-path')}]]";
                console.log(contextPath)
                $.ajax({
                  url: contextPath + '/my/orderList',
                  type: 'GET',
                  data: jsonData,
                  success: function(data) {
                    var contextPath = "[[${@environment.getProperty('server.servlet.context-path')}]]";
                    // 리스트
                    const orderList = $('.orderList');
                    orderList.children('option:not(:first)').remove();
                    for (let i = 0; i < data.dtoList.length; i++) {
                        orderList.append(`
                            <tr>
                                <td class="date">${data.dtoList[i].ordDate.substring(0, 10)}</td>
                                <td>
                                    <a href="#" class="thumb">
                                        <img src="${contextPath + '/thumb/' + data.dtoList[i].product.prodCate1 + '/' + data.dtoList[i].product.prodCate2 + '/' + data.dtoList[i].product.thumb1}" alt="">
                                    </a>
                                    <ul>
                                        <li class="company">${data.dtoList[i].product.company}</li>
                                        <li class="prodName"><a href="#">${data.dtoList[i].product.prodName}</a></li>
                                        <li>수량 : <span class="prodCount">${data.dtoList[i].count}</span>개 / 주문번호 : <span class="ordNo">${data.dtoList[i].ordNo}</span></li>
                                        <li class="prodPrice">${(data.dtoList[i].count * data.dtoList[i].product.price).toLocaleString()}</li>
                                    </ul>
                                </td>
                                <td class="status">배송완료</td>
                                <td class="confirm">
                                    <a href="#" class="receive">수취확인</a>
                                    <a href="#" class="review">상품평</a>
                                    <a href="#" class="refund">반품신청</a>
                                    <a href="#" class="exchange">교환신청</a>
                                </td>
                            </tr>
                        `);
                    }
                    // 페이징
                    const page = $('.page');
                    page.children().remove();

                    if (data.prev) {
                        page.append('<a href="#" class="prev" onclick="tableReload(data.start - 1); return false;">이전</a>');
                    }

                    for (let i = data.start; i <= data.end; i++) {
                        page.append('<a href="#" class="num ' + (data.pg == i ? `on` : ``) + '" onclick="tableReload(' + i + '); return false;">' + i + '</a>');
                    }

                    if (data.next) {
                        page.append('<a href="#" class="next" onclick="tableReload(data.end + 1); return false;">다음</a>');
                    }
                  }
              });
            }
        </script>
    </head>
    <div class="ordered" layout:fragment="content">
        <ul th:replace="~{/my/menu.html}">
        </ul>
        <section>
            <a href="#"><img th:src="@{/my/images/my_banner1.jpg}" alt="패션, 타운 하나로 끝" class="banner"></a>
            <article>
                <h3>전체주문내역</h3>
                <div class="byDate">
                    <span class="tit">기간별조회</span>
                    <ul class="date_3ea">
                        <li><a href="#" class="datePick" onclick="changeDate($(this), 'week'); return false;"><em>1</em>주일</a></li>
                        <li><a href="#" class="datePick" onclick="changeDate($(this), 'half'); return false;"><em>15</em>일</a></li>
                        <li><a href="#" class="datePick on"  onclick="changeDate($(this), 'month'); return false;"><em>1</em>개월</a></li>
                    </ul>
                    <ul class="date_5ea">
                    </ul>
                    <p>
                        <input type="date" name="begin"><span>~</span><input type="date" name="end">
                    </p>
                    <button class="btnConfirm">조회하기</button>
                </div>
                <table class="orderList">
                    <tr>
                        <th>날짜</th>
                        <th>상품정보</th>
                        <th>상태</th>
                        <th>확인/신청</th>
                    </tr>
                </table>
                <p class="page">
                </p>
            </article>
        </section>
    </div>
</html>